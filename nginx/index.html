<!DOCTYPE html>
<html lang="de-de" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">


  
  
    
      
        <link rel="stylesheet" href="/wiki/css/base.310c3f33692bd45145a733205f51ddfbd54778b209899347b6bdb58722cc57d2.css" integrity="sha256-MQw/M2kr1FFFpzMgX1Hd&#43;9VHeLIJiZNHtr21hyLMV9I=" crossorigin="anonymous">
      
    
  




<meta name="description" content="">
<title>Nginx - hmaier-dev wiki</title>

</head>
<body class="bg-gray-800 w-100vw">

  <div class="wrapper ml-[15%] max-w-[1200px]">

    <header class="bg-gray-50">
      


  
  
  <div class="flex justify-between">
  
  
    <div>
      <a href="https://hmaier-dev.github.io/wiki/" class="mr-2">
        home
      </a>
      
      <a href="https://hmaier-dev.github.io/wiki//hugo" class="mr-2"
                    title="Because of Hugo's nature as a static site generator, this button isn't truly random.
      It just gets newly generated with every build of the site.">
        random article
      </a>
      <a href="https://github.com/hmaier-dev" class="mr-2">
        github
      </a>
    </div>

  
    <div>
    </div>

  </div>





    </header>

    <main class="bg-gray-50 p-3
    
      mb-6 min-h-[calc(100vh-1rem)] max-sm:text-sm
    ">
      

  <script>
document.body.addEventListener("keydown", (e) => {
  if (e.key === 'Backspace'){
    window.location.href = "https:\/\/hmaier-dev.github.io\/wiki\/ "
  }
});

</script>
 
  
  <h1>Nginx</h1>

  
<button onclick="toggleList()" class="px-4 py-1 bg-slate-700 text-slate-400 font-semibold hover:cursor-pointer">Table of contents</button>
<div id="toc-list" class="bg-gray-300 max-w-min text-nowrap overflow-x-hidden">
<nav id="TableOfContents">
  <ul>
    <li><a href="#ssl">SSL</a>
      <ul>
        <li><a href="#zertifikat-zu-domain-hinzufügen">Zertifikat zu Domain hinzufügen</a></li>
        <li><a href="#sub-domäne-zu-bestehenden-zertifikat-hinzufügen">Sub-Domäne zu bestehenden Zertifikat hinzufügen</a></li>
      </ul>
    </li>
    <li><a href="#alias">Alias</a></li>
    <li><a href="#status-codes">Status Codes</a>
      <ul>
        <li><a href="#403"><code>403</code></a></li>
      </ul>
    </li>
    <li><a href="#configs">Configs</a>
      <ul>
        <li><a href="#static-html">Static HTML</a>
          <ul>
            <li><a href="#alias-1"><code>alias</code></a></li>
            <li><a href="#index"><code>index</code></a></li>
            <li><a href="#try_files"><code>try_files</code></a></li>
          </ul>
        </li>
        <li><a href="#reverse-proxy-with-docker-container">Reverse-Proxy with Docker-Container</a>
          <ul>
            <li><a href="#header">Header</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
</div>

<script>
  function toggleList() {
      var list = document.getElementById("toc-list");
      list.classList.toggle("hidden");
  }
</script>


  
      
      <h2 id="ssl">SSL<a href="/wiki/nginx/#ssl" class="font-medium text-blue-600 underline dark:text-blue-500 hover:no-underline hover:text-gray-800" ariaLabel="Anchor">#</a> </h2>
<p>Mit <code>certbot</code> lässt sich SSL relativ einfach ab-frühstücken.</p>
<h3 id="zertifikat-zu-domain-hinzufügen">Zertifikat zu Domain hinzufügen<a href="/wiki/nginx/#zertifikat-zu-domain-hinzufügen" class="font-medium text-blue-600 underline dark:text-blue-500 hover:no-underline hover:text-gray-800" ariaLabel="Anchor">#</a> </h3>
<h3 id="sub-domäne-zu-bestehenden-zertifikat-hinzufügen">Sub-Domäne zu bestehenden Zertifikat hinzufügen<a href="/wiki/nginx/#sub-domäne-zu-bestehenden-zertifikat-hinzufügen" class="font-medium text-blue-600 underline dark:text-blue-500 hover:no-underline hover:text-gray-800" ariaLabel="Anchor">#</a> </h3>
<p>Bevor man eine neue (Sub-)Domäne zum Zertifikat hinzufügt, muss der DNS-Eintrag schon live sein.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>certbot --expand -d existing.com -d www.exisiting.com -d newdomain.com
</span></span></code></pre></div><ul>
<li><a href="https://eff-certbot.readthedocs.io/en/latest/using.html#re-creating-and-updating-existing-certificates">https://eff-certbot.readthedocs.io/en/latest/using.html#re-creating-and-updating-existing-certificates</a></li>
</ul>
<h2 id="alias">Alias<a href="/wiki/nginx/#alias" class="font-medium text-blue-600 underline dark:text-blue-500 hover:no-underline hover:text-gray-800" ariaLabel="Anchor">#</a> </h2>
<p>Mit <code>alias</code> kann man Pfad bereitstellen, der nicht mit der <code>location</code> zusammenpasst. Fordert man mit der <code>root</code>-Direktive den Pfad <code>/preview/workshops/index.html</code> an,
würde Nginx nach <code>/var/www/html/static-html/preview/workshops/index.html</code> suchen. Die angeforderte URI wird also <em>appended</em>.
Bei der folgenden Directory-Struktur würde man aber nix finden:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>static-html
</span></span><span style="display:flex;"><span>├── about-me
</span></span><span style="display:flex;"><span>│   └── index.html
</span></span><span style="display:flex;"><span>├── css
</span></span><span style="display:flex;"><span>│   └── style.css
</span></span><span style="display:flex;"><span>├── favicon.ico
</span></span><span style="display:flex;"><span>├── index.html
</span></span><span style="display:flex;"><span>├── index.xml
</span></span><span style="display:flex;"><span>└── workshops
</span></span><span style="display:flex;"><span>    └── index.html
</span></span></code></pre></div><p>Mit der <code>alias</code>-Direktive wird der <code>/preview/</code>-Teil nicht mit angefordert, man kommt also <code>/var/www/html/static-html/preview/workshops/index.html</code> heraus.</p>
<p>Für mehr, hier ist eine gute Erklärung auf StackOverflow:</p>
<ul>
<li><a href="https://stackoverflow.com/questions/10631933/nginx-static-file-serving-confusion-with-root-alias">https://stackoverflow.com/questions/10631933/nginx-static-file-serving-confusion-with-root-alias</a></li>
</ul>
<h2 id="status-codes">Status Codes<a href="/wiki/nginx/#status-codes" class="font-medium text-blue-600 underline dark:text-blue-500 hover:no-underline hover:text-gray-800" ariaLabel="Anchor">#</a> </h2>
<p>A status code is more than a number.</p>
<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status">https://developer.mozilla.org/en-US/docs/Web/HTTP/Status</a></li>
<li><a href="https://en.wikipedia.org/wiki/List_of_HTTP_status_codes">https://en.wikipedia.org/wiki/List_of_HTTP_status_codes</a></li>
</ul>
<p>When troubleshooting use <code>curl -I &lt;url&gt;</code> to get unfiltered insights into the reponse.</p>
<h3 id="403"><code>403</code><a href="/wiki/nginx/#403" class="font-medium text-blue-600 underline dark:text-blue-500 hover:no-underline hover:text-gray-800" ariaLabel="Anchor">#</a> </h3>
<p>Wenn man einen <code>403</code> erhält, kann man sich ziemlich sein, dass etwas mit den Permissions nicht stimmt.
Daher den Owner sowie die Permissions der <em>ganzen</em> Directory überprüfen:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ls -la /var/www/html/static-html
</span></span><span style="display:flex;"><span>sudo chmod -R <span style="color:#ae81ff">755</span> /var/www/html/static-html<span style="color:#e6db74">`</span>
</span></span><span style="display:flex;"><span>sudo chown www-data:www-data /var/www/html/static-html<span style="color:#e6db74">`</span>
</span></span></code></pre></div><h2 id="configs">Configs<a href="/wiki/nginx/#configs" class="font-medium text-blue-600 underline dark:text-blue-500 hover:no-underline hover:text-gray-800" ariaLabel="Anchor">#</a> </h2>
<h3 id="static-html">Static HTML<a href="/wiki/nginx/#static-html" class="font-medium text-blue-600 underline dark:text-blue-500 hover:no-underline hover:text-gray-800" ariaLabel="Anchor">#</a> </h3>
<p>This config just serves static html under the path <code>/preview</code>.</p>
<h4 id="alias-1"><code>alias</code><a href="/wiki/nginx/#alias-1" class="font-medium text-blue-600 underline dark:text-blue-500 hover:no-underline hover:text-gray-800" ariaLabel="Anchor">#</a> </h4>
<p>When you want an URI with a different path in the filesystem,
e.g. <code>/var/www/html/static-html/page1/index.html</code> but not <code>/var/www/html/static-html/preview/page1/index.html</code>,
then <code>alias</code> is your directive of choice.</p>
<h4 id="index"><code>index</code><a href="/wiki/nginx/#index" class="font-medium text-blue-600 underline dark:text-blue-500 hover:no-underline hover:text-gray-800" ariaLabel="Anchor">#</a> </h4>
<p>Tells Nginx for which files to look, when a directory is requested. In this case <code>index</code> directs a directory-request to <code>index.html</code>.
Without it <code>http://localhost/preview/site1</code> would not work and would need <code>http://localhost/preview/site1/index.html</code>.
Technically, if you have <code>try_files</code> setup that it directs to <code>index.html</code>, you wouldn&rsquo;t need it.</p>
<h4 id="try_files"><code>try_files</code><a href="/wiki/nginx/#try_files" class="font-medium text-blue-600 underline dark:text-blue-500 hover:no-underline hover:text-gray-800" ariaLabel="Anchor">#</a> </h4>
<p>Looks for the different cases defined. Note that this hinders a redirect!</p>
<ol>
<li><code>$uri</code> just takes the URI as it is. <code>http://localhost/preview/index.html</code> would connect, but <code>http://localhost/preview/</code> not.</li>
<li><code>$uri/index.html</code> append the <code>index.html</code>. As it is the second case, existent URI with or without <code>index.html</code> would get <code>200</code>.</li>
<li>If nothing fits the schema, do a <code>404</code> response.</li>
</ol>
<p>Because of <code>$uri/index.html</code>, <code>http://localhost/preview</code> (without a trailing slash) as well as <code>http://localhost/preview/</code> (with a trailing slash) will work!</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#66d9ef">server</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">server_name</span> <span style="color:#e6db74">localhost</span>;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">location</span> <span style="color:#e6db74">/preview</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">alias</span> <span style="color:#e6db74">/var/www/html/static-html</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">index</span> <span style="color:#e6db74">index.html</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">try_files</span> $uri $uri/index.html =<span style="color:#ae81ff">404</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">error_page</span> <span style="color:#ae81ff">404</span> <span style="color:#e6db74">/404.html</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">access_log</span> <span style="color:#e6db74">/var/log/nginx/website_access.log</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">error_log</span> <span style="color:#e6db74">/var/log/nginx/website_error.log</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="reverse-proxy-with-docker-container">Reverse-Proxy with Docker-Container<a href="/wiki/nginx/#reverse-proxy-with-docker-container" class="font-medium text-blue-600 underline dark:text-blue-500 hover:no-underline hover:text-gray-800" ariaLabel="Anchor">#</a> </h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#66d9ef">server</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">server_name</span> <span style="color:#e6db74">localhost</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">location</span> <span style="color:#e6db74">/</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">proxy_pass</span> <span style="color:#e6db74">http://localhost:8080</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">proxy_redirect</span>                      <span style="color:#66d9ef">off</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">proxy_set_header</span>  <span style="color:#e6db74">Host</span>              $http_host;
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">proxy_set_header</span>  <span style="color:#e6db74">X-Real-IP</span>         $remote_addr;
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">proxy_set_header</span>  <span style="color:#e6db74">X-Forwarded-For</span>   $proxy_add_x_forwarded_for;
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">proxy_set_header</span>  <span style="color:#e6db74">X-Forwarded-Proto</span> $scheme;
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">proxy_read_timeout</span>                  <span style="color:#ae81ff">900</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">access_log</span> <span style="color:#e6db74">/var/log/nginx/docker_access.log</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">error_log</span> <span style="color:#e6db74">/var/log/nginx/docker_error.log</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="header">Header<a href="/wiki/nginx/#header" class="font-medium text-blue-600 underline dark:text-blue-500 hover:no-underline hover:text-gray-800" ariaLabel="Anchor">#</a> </h4>
<ul>
<li><code>proxy_set_header  Host              $http_host;</code></li>
<li><code>proxy_set_header  X-Real-IP         $remote_addr;</code></li>
<li><code>proxy_set_header  X-Forwarded-For   $proxy_add_x_forwarded_for;</code></li>
<li><code>proxy_set_header  X-Forwarded-Proto $scheme;</code>
<ul>
<li>Set the protocol to <code>http</code> or <code>https</code></li>
</ul>
</li>
</ul>

  


    </main>
   
    <footer class="py-3 m-12 bg-gray-50 rounded">
      

  <div class="mb-3 flex justify-center">
    
    <a class="mx-3" href="/wiki/oscdimg/">Previous Page</a>
    
    <a class="mx-3" href="https://hmaier-dev.github.io/wiki/">Go to Home</a>
    
    <a class="mx-3" href="/wiki/neovim/">Next Page</a>
    
  </div>



<div class="font-mono text-xs">
Powered by <a href="https://gohugo.io/">Hugo</a> and <a href="https://tailwindcss.com/">Tailwind</a>. Hosted on Github-Pages by <a href="https://github.com/hmaier-dev/wiki">hmaier-dev/wiki</a>.
</div>

    <footer>

  </div>


</body>
</html>
